<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POST /api/image demo</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
    label, button { display: inline-block; margin: .5rem 0; }
    input[type="text"] { width: 60%; padding: .3rem; }
    #items { margin: .5rem 0 1rem 0; padding-left: 1rem; }
    pre { background:#f5f5f5; padding: .75rem; border-radius:4px; overflow:auto; }
  </style>
</head>
<body>
  <h1>Gửi POST /api/image</h1>

  <form id="form">
    <label>Thêm giá trị vào mảng "da_co":</label><br/>
    <input id="newItem" type="text" placeholder="ví dụ: 'item1'"/>
    <button id="addBtn" type="button">Thêm</button>
    <button id="clearBtn" type="button">Xóa tất cả</button>

    <div id="items"></div>

    <button id="sendBtn" type="submit">Gửi POST (Content-Type: application/json)</button>
  </form>

  <h2>Yêu cầu gửi</h2>
  <pre id="requestPreview">{ "da_co": [] }</pre>

  <h2>Phản hồi</h2>
  <pre id="responsePreview">Chưa gửi</pre>

  <script>
    const itemsDiv = document.getElementById('items');
    const newItemInput = document.getElementById('newItem');
    const addBtn = document.getElementById('addBtn');
    const clearBtn = document.getElementById('clearBtn');
    const form = document.getElementById('form');
    const requestPreview = document.getElementById('requestPreview');
    const responsePreview = document.getElementById('responsePreview');

    let arr = [];

    function renderItems() {
      itemsDiv.innerHTML = '';
      if (arr.length === 0) {
        itemsDiv.textContent = 'Mảng trống';
      } else {
        const ul = document.createElement('ul');
        arr.forEach((it, idx) => {
          const li = document.createElement('li');
          li.textContent = JSON.stringify(it);
          const rm = document.createElement('button');
          rm.textContent = 'x';
          rm.style.marginLeft = '0.5rem';
          rm.addEventListener('click', () => {
            arr.splice(idx, 1);
            updatePreview();
            renderItems();
          });
          li.appendChild(rm);
          ul.appendChild(li);
        });
        itemsDiv.appendChild(ul);
      }
      updatePreview();
    }

    function updatePreview() {
      requestPreview.textContent = JSON.stringify({ da_co: arr }, null, 2);
    }

    addBtn.addEventListener('click', () => {
      const v = newItemInput.value.trim();
      if (v === '') return;
      try {
        // allow user to input raw JSON values like numbers, objects, arrays, or strings
        const parsed = JSON.parse(v);
        arr.push(parsed);
      } catch {
        // if not valid JSON, push as string
        arr.push(v);
      }
      newItemInput.value = '';
      renderItems();
    });

    clearBtn.addEventListener('click', () => {
      arr = [];
      renderItems();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = { da_co: arr };
      requestPreview.textContent = JSON.stringify(payload, null, 2);
      responsePreview.textContent = 'Đang gửi...';

      try {
        const res = await fetch('http://localhost:8080/api/image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const text = await res.text();
        responsePreview.textContent = `HTTP ${res.status} ${res.statusText}\n\n${text}`;
      } catch (err) {
        responsePreview.textContent = 'Lỗi khi gửi: ' + err.message;
      }
    });

    // initial render
    renderItems();
  </script>
</body>
</html>